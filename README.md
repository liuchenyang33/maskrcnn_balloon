# maskrcnn_balloon
## 分割前气球

![2917282960_06beee649a_b.jpg](https://github.com/liuchenyang33/maskrcnn_balloon/blob/master/images/2917282960_06beee649a_b.jpg)
## 分割后气球

![segment_2917282960_06beee649a_b.jpg](https://github.com/liuchenyang33/maskrcnn_balloon/blob/master/images/segment_2917282960_06beee649a_b.jpg)

# 步骤
	
## 1、数据集读取处理和准备

		
实现数据标签文件的读取
	
## 2、模型配置文件解析与修改、模型预训练模型加载、模型构建

		
maskrcnn模型源码中Sequence封装数据集类使用
		
maskrcnn配置介绍
		
模型文件过程使用源码解析
	
## 3、模型训练过程实现

		
训练代码封装介绍
	
## 4、模型测试过程实现

		* 
# 图片预测结果处理



分割数据集介绍-气球分割数据集气球分割数据集是一个小型的分割任务数据。目的是将气球从图片或者视频中分割出来。数据集有训练集和验证集目录如下：


训练验证都含有.json标注文件以及jpg文件

大多数分割通过VIA tool标注工具可以生成每个图片的mask结果
		
注意：这里的标注数据中并没有提供检测框的标注信息，后期检测框的生成是动态根据mask结果生成的

		
voc,coco等数据集中会提供了两者标注结果


其中json文件中的标注格式包含如下：

{
# 第一张图片的物体标记结果
"24631331976_defa3bb61f_k.jpg668058":{"fileref":"",
"size":668058,"filename":"24631331976_defa3bb61f_k.jpg",
"base64_img_data":"","file_attributes":{},
"regions":{"0":{"shape_attributes":{"name":"polygon","all_points_x":[916,913,905,889,868,836,809,792,789,784,777,769,767,777,786,791,769,739,714,678,645,615,595,583,580,584,595,614,645,676,716,769,815,849,875,900,916,916],"all_points_y":[515,583,616,656,696,737,753,767,777,785,785,778,768,766,760,755,755,743,728,702,670,629,588,539,500,458,425,394,360,342,329,331,347,371,398,442,504,515]},"region_attributes":{}}}},
# 第二张图片的物体标记
"16335852991_f55de7958d_k.jpg1767935":{"fileref":"","size":1767935,"filename":"16335852991_f55de7958d_k.jpg","base64_img_data":"","file_attributes":{},
"regions":{
"0":{"shape_attributes":{"name":"polygon","all_points_x":[588,617,649,673,692,708,722,730,737,718,706,699,697,676,650,613,580,552,534,520,513,513,521,526,541,560,588],"all_points_y":[173,168,172,182,197,216,237,260,283,312,341,367,390,369,349,337,337,347,361,332,296,266,243,225,205,187,173]},"region_attributes":{}},
"1":{"shape_attributes":{"name":"polygon","all_points_x":[845,861,880,892,902,910,889,869,844,813,785,762,745,739,731,746,767,790,821,845],"all_points_y":[219,229,242,260,275,299,277,263,254,250,255,265,279,283,258,241,225,216,213,219]},"region_attributes":{}},
"2":{"shape_attributes":{"name":"polygon","all_points_x":[931,928,920,913,897,872,840,811,789,768,754,730,726,724,718,698,698,707,721,734,746,769,794,822,845,865,889,910,921,929,931],"all_points_y":[378,402,435,454,475,460,450,449,450,460,469,489,486,459,426,390,367,335,306,290,278,261,252,250,254,261,277,299,323,354,378]},"region_attributes":{}},
"3":{"shape_attributes":{"name":"polygon","all_points_x":[927,946,968,989,992,985,975,957,937,913,889,862,852,876,897,910,925,933,939,939,935,927,910,900,927],"all_points_y":[486,498,516,553,593,630,649,668,686,700,707,707,708,691,675,656,635,610,587,562,538,512,492,480,486]},"region_attributes":{}},
"4":{"shape_attributes":{"name":"polygon","all_points_x":[704,692,690,691,699,711,723,742,766,785,807,839,865,887,904,923,933,939,939,931,920,905,885,861,839,808,786,769,754,748,746,738,738,729,722,718,704],"all_points_y":[664,631,604,580,545,521,498,480,461,452,449,449,457,469,484,506,532,565,584,620,643,662,682,701,713,719,723,728,733,731,738,737,729,720,708,690,664]},"region_attributes":{}},
"5":{"shape_attributes":{"name":"polygon","all_points_x":[526,509,497,493,490,493,501,512,526,546,573,603,626,662,688,709,721,724,724,719,704,694,691,691,682,683,687,688,684,682,679,676,664,648,620,587,564,548,526],"all_points_y":[551,526,498,470,444,422,398,381,365,351,340,338,340,357,381,408,438,466,493,504,531,568,584,604,609,612,610,617,625,625,619,616,620,619,609,599,585,573,551]},"region_attributes":{}},
"6":{"shape_attributes":{"name":"polygon","all_points_x":[594,579,567,563,564,568,579,605,631,656,671,676,682,684,687,687,684,684,691,691,694,702,711,719,722,729,737,738,746,749,756,765,757,728,714,683,654,623,594],"all_points_y":[735,712,691,659,631,612,596,605,613,621,618,616,625,625,616,612,612,608,605,619,637,656,678,692,706,719,727,737,739,731,734,730,741,762,766,772,769,757,735]},"region_attributes":{}}
}},
...
...
...
其中："all_points_x":[588,617,649,673,692,708,722,730,737,718,706,699,697,676,650,613,580,552,534,520,513,513,521,526,541,560,588],"all_points_y":[173,168,172,182,197,216,237,260,283,312,341,367,390,369,349,337,337,347,361,332,296,266,243,225,205,187,173]}
表示该被标注物体所有像素点的坐标。6.8.2 模型介绍
选用maskrcnn模型进行分割案例。maskrcnn的源码版本中选择最新的2.0版本。github高星实现版本
	* 
高星版本：MaskRCNN。

		* 
TensorFlow与keras实现的版本，代码只能在1.x版本运行，需要同时keras和TensorFlow两个库才能运行


使用版本是基于这个版本修改之后能在2.0环境下运行的maskrcnn源码。
并且预训练模型地址：maskrcnn迁移学习预训练模型。
	* 
可以使用多种预训练模型，这里提供Imagenet数据集训练的迁移模型


